<html>
<head>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image.prod.js"></script>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-aframe.prod.js"></script>

  <!-- F端r gifs -->
  <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
  <script src="https://rawgit.com/mayognaise/aframe-gif-component/master/dist/aframe-gif-component.min.js"></script>

  <!-- F端r vids -->
  <script src="https://rawgit.com/mayognaise/aframe-video-shader/master/dist/aframe-vid-shader.min.js"></script>

  <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- Quelle: https://jsfiddle.net/Lwtzjnk9/1/ f端r png sequenzen -->


  <script>

    // Was fehlt: GLTF-Modell und ballon gif 端berarbeiten
    // pausieren am anfang
    // Sound abspielen
    // hosten

    document.addEventListener("DOMContentLoaded", function() {
      const sceneEl = document.querySelector('a-scene');
      const arSystem = sceneEl.systems["mindar-image-system"];

      // arReady event triggered when ready
      sceneEl.addEventListener("arReady", (event) => {
        init: function() {
          console.log("MindAR is ready")
        }

      });
      myTarget.addEventListener("targetFound", event => {
        console.log("target found");

      });
      // detect target lost
      myTarget.addEventListener("targetLost", event => {
        console.log("target lost");
      });

    });

  </script>
</head>
<body>




<a-scene mindar-image="imageTargetSrc: ./targets.mind;" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
  <a-assets>
    <img id="card" src="8359_BG2.png" />

    <!-- GIFS -->
    <img id="ballon" src="8359_ohne_konfetti.gif" />
    <img id="dancebear" src="8435.gif"  />
    <img id="lovers" src="8406A.gif" />

    <!-- SOUNDS -->
    <audio id="soundii" src="wee-sound-effect.mp3" preload="auto" loop ></audio>

    <!-- GLTF -->
    <a-asset-item id="confetti" src="./imported_mp4_ballon_2.gltf"></a-asset-item>

  </a-assets>

  <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="far: ${customFields.libVersion}; objects: .clickable"></a-camera>

  <a-entity id="example-target"  mindar-image-target="targetIndex: 0" >
    <!-- GLTF STARTEN -->
    <a-gltf-model rotation="0 0 0 " position="0 0 0.3" src="#confetti" animation-mixer=""> </a-gltf-model>
    <a-entity id="ballon" geometry="primitive:plane;" scale="1 1.5 1" position="0 0 0.1" material="shader:gif;src:#ballon" ></a-entity>
    <a-sound id="soundneu" src="soundii" autoplay="true" detect-target> </a-sound>
    <!-- SOUND STARTEN-->
  </a-entity>

  <a-entity mindar-image-target="targetIndex: 1">
    <a-entity id="lovers" geometry="primitive:plane;" scale="1 1.5 1" position="0 0 0.1" material="shader:gif;src:#lovers" detect-target ></a-entity>
  </a-entity>

  <a-entity mindar-image-target="targetIndex: 2">
    <a-entity id="dancebear" geometry="primitive:plane;" scale="1 1.5 1" position="0 0 0.1" material="shader:gif;src:#dancebear" play-on-click ></a-entity>
  </a-entity>

</a-scene>



<script>
  // detect target found




  // detect
  //dauert zu lange... aber klappt
  AFRAME.registerComponent("detect-target", {
    init: function() {
      document.body.addEventListener("targetFound", e => {
        console.log("detected!");
        var el = this.el;
        var mat = el.getAttribute('id');
        el.removeAttribute('material');
        el.setAttribute('material', {
          shader: "gif",
          src: "#" + mat
        });
      });
    }
  });

  // clickable
  AFRAME.registerComponent("play-on-click", {
    init: function() {
      document.body.addEventListener("click", e => {
        console.log("clicked!");
        var el = this.el;
        el.play();
      });
    }
  });

</script>

</body>
</html>